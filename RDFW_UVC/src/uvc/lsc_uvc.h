// >>>>>>>>>>>>>>>>>>>>>>> COPYRIGHT NOTICE <<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
// --------------------------------------------------------------------------
// Copyright (c) 2019-2024 by Lattice Semiconductor Corporation
// ALL RIGHTS RESERVED
// --------------------------------------------------------------------------
//
// IMPORTANT: THIS FILE IS USED BY OR GENERATED BY the LATTICE PROPELâ„¢
// DEVELOPMENT SUITE, WHICH INCLUDES PROPEL BUILDER AND PROPEL SDK.
//
// Lattice grants permission to use this code pursuant to the
// terms of the Lattice Propel License Agreement.
//
// DISCLAIMER:
//
//  LATTICE MAKES NO WARRANTIES ON THIS FILE OR ITS CONTENTS, WHETHER
//  EXPRESSED, IMPLIED, STATUTORY, OR IN ANY PROVISION OF THE LATTICE
//  PROPEL LICENSE AGREEMENT OR COMMUNICATION WITH LICENSEE, AND LATTICE
//  SPECIFICALLY DISCLAIMS ANY IMPLIED WARRANTY OF MERCHANTABILITY OR
//  FITNESS FOR A PARTICULAR PURPOSE.  LATTICE DOES NOT WARRANT THAT THE
//  FUNCTIONS CONTAINED HEREIN WILL MEET LICENSEE'S REQUIREMENTS, OR THAT
//  LICENSEE'S OPERATION OF ANY DEVICE, SOFTWARE OR SYSTEM USING THIS FILE
//  OR ITS CONTENTS WILL BE UNINTERRUPTED OR ERROR FREE, OR THAT DEFECTS
//  HEREIN WILL BE CORRECTED.  LICENSEE ASSUMES RESPONSIBILITY FOR
//  SELECTION OF MATERIALS TO ACHIEVE ITS INTENDED RESULTS, AND FOR THE
//  PROPER INSTALLATION, USE, AND RESULTS OBTAINED THEREFROM.  LICENSEE
//  ASSUMES THE ENTIRE RISK OF THE FILE AND ITS CONTENTS PROVING DEFECTIVE
//  OR FAILING TO PERFORM PROPERLY AND IN SUCH EVENT, LICENSEE SHALL
//  ASSUME THE ENTIRE COST AND RISK OF ANY REPAIR, SERVICE, CORRECTION, OR
//  ANY OTHER LIABILITIES OR DAMAGES CAUSED BY OR ASSOCIATED WITH THE
//  SOFTWARE.  IN NO EVENT SHALL LATTICE BE LIABLE TO ANY PARTY FOR DIRECT,
//  INDIRECT,SPECIAL, INCIDENTAL, OR CONSEQUENTIAL DAMAGES, INCLUDING LOST
//  PROFITS, ARISING OUT OF THE USE OF THIS FILE OR ITS CONTENTS, EVEN IF
//  LATTICE HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES. LATTICE'S
//  SOLE LIABILITY, AND LICENSEE'S SOLE REMEDY, IS SET FORTH ABOVE.
//  LATTICE DOES NOT WARRANT OR REPRESENT THAT THIS FILE, ITS CONTENTS OR
//  USE THEREOF DOES NOT INFRINGE ON THIRD PARTIES' INTELLECTUAL PROPERTY
//  RIGHTS, INCLUDING ANY PATENT. IT IS THE USER'S RESPONSIBILITY TO VERIFY
//  THE USER SOFTWARE DESIGN FOR CONSISTENCY AND FUNCTIONALITY THROUGH THE
//  USE OF FORMAL SOFTWARE VALIDATION METHODS.
// --------------------------------------------------------------------------

/****************************************************************************/
/**
 *
 * @file lsc_uvc.h
 * @addtogroup lscusb Overview
 * @{
 *
 *
 *****************************************************************************/

#ifndef UVC_LSC_UVC_H_
#define UVC_LSC_UVC_H_

#ifdef __cplusplus
extern "C" {
#endif

/***************************** Include Files ********************************/
#include <sys/_stdint.h>
#include "lsc_usb_ch9.h"
#include "lsc_usb_dev.h"

#pragma pack(1)

/************************** Constant Definitions ****************************/
#define UVC1_5                       /**< Enable this macros if device has UVC 1.5 support. */
//#define STILL_IMG_CAP                /**< Enable this macros if device still image capture is supported. */
#define UVC_YUY2                    /**< Enable this macros to for YUY2 format. Otherwise, it is JPEG format. */

#define NO_OF_VIDEO_STREAMING_INTERFACES                    1
#define NO_OF_FRAMES_IN_STILL_IMAGE                         1      /**< This macro defines number of frames in Still Image. */
#define NO_OF_FRAMES_IN_UNCOMPRESSED_FORMAT                 1      /**< This macro defines number of frames in Uncompressed Format. */

#ifdef UVC1_5
#define NO_OF_CAMERA_CONTROLS_SUPPORTED                     (24/8)//UVC1.5
#define NO_OF_PROCESSING_UNIT_0_CONTROLS_SUPPORTED          (24/8)//UVC1.5
#define NO_OF_SIMULCAST_STREAM_SUPPORTED                    (4)   //UVC1.5
#else
#define NO_OF_CAMERA_CONTROLS_SUPPORTED                     (19/8)
#define NO_OF_PROCESSING_UNIT_0_CONTROLS_SUPPORTED          (19/8)
#endif

#define NO_OF_EXTENSION_UNIT_CONTROLS_SUPPORTED             1
#define EXTENSION_UNIT_CONTROLS_SUPPORTED_SZ                1
#define NO_OF_EXTENSION_UNIT_INPUT_PINS_SUPPORTED           1
#define NO_OF_VIDEO_STREAMING_INTERFACES                    1
#define NO_OF_FORMATS_SUPPORTED_BY_VIDEO_STREAM_INTERFACE   1

//------------------------------------------------
//Video Interface Class Code
#define CC_VIDEO 0x0E

//------------------------------------------------
//Video Interface Subclass Codes
#define SC_UNDEFINED                    0x00
#define SC_VIDEOCONTROL                 0x01
#define SC_VIDEOSTREAMING               0x02
#define SC_VIDEO_INTERFACE_COLLECTION   0x03

//------------------------------------------------
//Video Interface Protocol Codes
#define PC_PROTOCOL_UNDEFINED           0x00
#define PC_PROTOCOL_15                  0x01

//------------------------------------------------
//Video Class-Specific Descriptor Types

#define CS_UNDEFINED        0x20
#define CS_DEVICE           0x21
#define CS_CONFIGURATION    0x22
#define CS_STRING           0x23
#define CS_INTERFACE        0x24
#define CS_ENDPOINT         0x25

//------------------------------------------------
//Video Class-Specific VC Interface Descriptor Subtypes

#define VC_DESCRIPTOR_UNDEFINED     0x00
#define VC_HEADER                   0x01
#define VC_INPUT_TERMINAL           0x02
#define VC_OUTPUT_TERMINAL          0x03
#define VC_SELECTOR_UNIT            0x04
#define VC_PROCESSING_UNIT          0x05
#define VC_EXTENSION_UNIT           0x06

//------------------------------------------------
//Video Class-Specific VS Interface Descriptor Subtypes

#define VS_UNDEFINED                0x00
#define VS_INPUT_HEADER             0x01
#define VS_OUTPUT_HEADER            0x02
#define VS_STILL_IMAGE_FRAME        0x03
#define VS_FORMAT_UNCOMPRESSED      0x04
#define VS_FRAME_UNCOMPRESSED       0x05
#define VS_FORMAT_MJPEG             0x06
#define VS_FRAME_MJPEG              0x07
//#define Reserved                  0x08
//#define Reserved                  0x09
#define VS_FORMAT_MPEG2TS           0x0A
//#define Reserved                  0x0B
#define VS_FORMAT_DV                0x0C
#define VS_COLORFORMAT              0x0D
//#define Reserved                  0x0E
//#define Reserved                  0x0F
#define VS_FORMAT_FRAME_BASED       0x10
#define VS_FRAME_FRAME_BASED        0x11
#define VS_FORMAT_STREAM_BASED      0x12

//------------------------------------------------
//Video Class-Specific Endpoint Descriptor Subtypes

#define EP_UNDEFINED                0x00
#define EP_GENERAL                  0x01
#define EP_ENDPOINT                 0x02
#define EP_INTERRUPT                0x03

//------------------------------------------------
//Video Class-Specific Request Codes

#define RC_UNDEFINED        0x00
#define SET_CUR             0x01
#define GET_CUR             0x81
#define GET_MIN             0x82
#define GET_MAX             0x83
#define GET_RES             0x84
#define GET_LEN             0x85
#define GET_INFO            0x86
#define GET_DEF             0x87

//------------------------------------------------
//VideoControl Interface Control Selectors

#define VC_CONTROL_UNDEFINED            0x00
#define VC_VIDEO_POWER_MODE_CONTROL     0x01
#define VC_REQUEST_ERROR_CODE_CONTROL   0x02
#define VC_Reserved                     0x03

//------------------------------------------------
//Terminal Control Selectors

#define TE_CONTROL_UNDEFINED            0x00

//------------------------------------------------
//Selector Unit Control Selectors

#define SU_CONTROL_UNDEFINED                0x00
#define SU_INPUT_SELECT_CONTROL             0x01
#define CT_CONTROL_UNDEFINED                0x00
#define CT_SCANNING_MODE_CONTROL            0x01
#define CT_AE_MODE_CONTROL                  0x02
#define CT_AE_PRIORITY_CONTROL              0x03
#define CT_EXPOSURE_TIME_ABSOLUTE_CONTROL   0x04
#define CT_EXPOSURE_TIME_RELATIVE_CONTROL   0x05
#define CT_FOCUS_ABSOLUTE_CONTROL           0x06
#define CT_FOCUS_RELATIVE_CONTROL           0x07
#define CT_FOCUS_AUTO_CONTROL               0x08
#define CT_IRIS_ABSOLUTE_CONTROL            0x09
#define CT_IRIS_RELATIVE_CONTROL            0x0A
#define CT_ZOOM_ABSOLUTE_CONTROL            0x0B
#define CT_ZOOM_RELATIVE_CONTROL            0x0C
#define CT_PANTILT_ABSOLUTE_CONTROL         0x0D
#define CT_PANTILT_RELATIVE_CONTROL         0x0E
#define CT_ROLL_ABSOLUTE_CONTROL            0x0F
#define CT_ROLL_RELATIVE_CONTROL            0x10
#define CT_PRIVACY_CONTROL                  0x11

//------------------------------------------------
//Processing Unit Control Selectors

#define PU_CONTROL_UNDEFINED                        0x00
#define PU_BACKLIGHT_COMPENSATION_CONTROL           0x01
#define PU_BRIGHTNESS_CONTROL                       0x02
#define PU_CONTRAST_CONTROL                         0x03
#define PU_GAIN_CONTROL                             0x04
#define PU_POWER_LINE_FREQUENCY_CONTROL             0x05
#define PU_HUE_CONTROL                              0x06
#define PU_SATURATION_CONTROL                       0x07
#define PU_SHARPNESS_CONTROL                        0x08
#define PU_GAMMA_CONTROL                            0x09
#define PU_WHITE_BALANCE_TEMPERATURE_CONTROL        0x0A
#define PU_WHITE_BALANCE_TEMPERATURE_AUTO_CONTROL   0x0B
#define PU_WHITE_BALANCE_COMPONENT_CONTROL          0x0C
#define PU_WHITE_BALANCE_COMPONENT_AUTO_CONTROL     0x0D
#define PU_DIGITAL_MULTIPLIER_CONTROL               0x0E
#define PU_DIGITAL_MULTIPLIER_LIMIT_CONTROL         0x0F
#define PU_HUE_AUTO_CONTROL                         0x10
#define PU_ANALOG_VIDEO_STANDARD_CONTROL            0x11
#define PU_ANALOG_LOCK_STATUS_CONTROL               0x12

//------------------------------------------------
//Extension Unit Control Selectors

#define XU_CONTROL_UNDEFINED    0x00

//------------------------------------------------
//VideoStreaming Interface Control Selectors

#define VS_CONTROL_UNDEFINED                0x00
#define VS_PROBE_CONTROL                    0x01
#define VS_COMMIT_CONTROL                   0x02
#define VS_STILL_PROBE_CONTROL              0x03
#define VS_STILL_COMMIT_CONTROL             0x04
#define VS_STILL_IMAGE_TRIGGER_CONTROL      0x05
#define VS_STREAM_ERROR_CODE_CONTROL        0x06
#define VS_GENERATE_KEY_FRAME_CONTROL       0x07
#define VS_UPDATE_FRAME_SEGMENT_CONTROL     0x08
#define VS_SYNCH_DELAY_CONTROL              0x09

//------------------------------------------------
//USB Terminal Types

#define TT_VENDOR_SPECIFIC 0x0100  /**<
                                        I/O A Terminal dealing with a signal carried over a vendor-specific interface. \n
                                        The vendor-specific interface descriptor must contain a field that references the Terminal. */

#define TT_STREAMING       0x0101  /**<
                                        I/O A Terminal dealing with a signal carried over an endpoint in a
                                        VideoStreaming interface. The VideoStreaming interface descriptor points to
                                        the associated Terminal through the bTerminalLink field. */

//------------------------------------------------
//Input Terminal Types

#define ITT_VENDOR_SPECIFIC         0x0200      /**< Vendor-Specific Input Terminal. */
#define ITT_CAMERA                  0x0201      /**< Camera sensor. To be used only in Camera Terminal descriptors. */
#define ITT_MEDIA_TRANSPORT_INPUT   0x0202      /**< Sequential media. To be used only in Media Transport Terminal Descriptors. */
//------------------------------------------------
//Output Terminal Types

#define OTT_ VENDOR_SPECIFIC        0x0300      /**< Vendor-Specific Output Terminal. */
#define OTT_DISPLAY                 0x0301      /**< Generic display (LCD,CRT, etc.). */
#define OTT_MEDIA_TRANSPORT_OUTPUT  0x0302      /**< Sequential media . To be used only in Media Transport Terminal Descriptors. */
//------------------------------------------------
//External Terminal Types

#define EXTERNAL_ VENDOR_SPECIFIC   0x0400      /**< Vendor-Specific External Terminal. */
#define COMPOSITE_CONNECTOR         0x0401      /**< Composite video connector. */
#define SVIDEO_CONNECTOR            0x0402      /**< S-video connector. */
#define COMPONENT_CONNECTOR         0x0403      /**< Component video connector. */
//-------------------------------------------------
//Error codes for processing unit

#define ERR_CODE_NO_ERR                       0x00
#define ERR_CODE_NOT_READY                    0x01
#define ERR_CODE_WRONG_STATE                  0x02
#define ERR_CODE_POWER                        0x03
#define ERR_CODE_OUT_OF_RANGE                 0x04
#define ERR_CODE_INVALID_UNIT                 0x05
#define ERR_CODE_INVALID_CTRL                 0x06
#define ERR_CODE_INVALID_REQ                  0x07
#define ERR_CODE_INVALID_VALUE_WITHIN_RANGE   0x08 //UVC 1.5
#define ERR_CODE_INVALID_UNKNOWN              0xFF

//---------------------------------------------------
//Change in descriptor structure bmControls field as per UVC 1.5 specification
#ifdef UVC1_5
#define PU_D_BM_CTRLS                        {0x00,0x00,0x00}
#define CTD_BM_CTRLS                         {0x00,\
                                              0x00,\
                                              0x00}
#else
#define PU_D_BM_CTRLS                        {0x00,0x00}
#define CTD_BM_CTRLS                         {0x00,\
                                              0x00}
#endif

#define EU_D_BM_CTRLS                        {0x01}

#define EU_D_SRC_ID                          {0x02}

#define PU_0_D_ID                            0x03
#define EU_D_ID                              0x04

#ifdef UVC1_5
#define PC_PROTOCOL_VAL                 PC_PROTOCOL_15
#define BCD_UVC                         0x0150              //UVC 1.5
#else
#define PC_PROTOCOL_VAL                 PC_PROTOCOL_UNDEFINED
#define BCD_UVC                         0x0100              //UVC 1.0
#endif

#ifdef STILL_IMG_CAP
#define STILL_IMG_CAP_METHOD            0x02   //Change still image capture method whichever is supported.
#define NO_OF_INTR_EP_STILL_IMG_CAP     0x1    //Number of interrupt endpoint used for still image capture method
#define TRIGGER_SUPPORT                 0x1    //If hardware trigger is supported then keep 0x1 otherwise zero.
#else
#define STILL_IMG_CAP_METHOD            0x00   //Indicated still image capture support is not there.
#define NO_OF_INTR_EP_STILL_IMG_CAP     0x00
#define TRIGGER_SUPPORT                 0x00    //Hardware trigger is not supported
#endif

#define NO_OF_OTHER_EP                  0x00

#define NO_OF_EP_INTERFACE_DESC_BULK    NO_OF_INTR_EP_STILL_IMG_CAP + NO_OF_OTHER_EP //Add other endpoints associated with this interface if any, to this macro.
#define NO_OF_EP_INTERFACE_DESC_ISO     NO_OF_INTR_EP_STILL_IMG_CAP + NO_OF_OTHER_EP //Add other endpoints associated with this interface if any, to this macro.

//100 MHZ - 0x05F5E100
#define DEV_CLK_FREQ       0x05F5E100       /**<The device clock frequency in Hz for the specified format*/

#define YUY2_GUID {0x59,0x55,0x59,0x32,0x00,0x00,0x10,0x00,0x80,0x00,0x00,0xAA,0x00,0x38,0x9B,0x71}

#define BITSPERPIXEL 0x10

#define UVCFD_FRAME_INDEX     0x01
#define UVCFD_CAPABILITIES    0x00

#define WIDTH   1920  // 1920////1280 //640   //    //0x0780
#define HEIGHT  1080 //1080///720  ///480  //     //0x0438

#define MAXBITRATE 0xFFFFFFFF
#define MINBITRATE 0xFFFFFFFF

//#define DEFAULTFRAMEINTERVAL   0x000182C1   //0x00028AC8            //(16.66 ms -> 60.00 fps) ;; (DEFAULTFRAMEINTERVAL*100)ns
#define DEFAULTFRAMEINTERVAL   0x00017406   //0x00028AC8            //(16.66 ms -> 60.00 fps) ;; (DEFAULTFRAMEINTERVAL*100)ns
#define UVCFD_FRAMEINTERVALTYPE      0x00        //Should be 0x00 for continuous frame interval
#define MINIMUMFRAMEINTERVAL  DEFAULTFRAMEINTERVAL  //(16.66 ms -> 60.00 fps) ;; (1000ms / 16.66ms) = ~60fps
#define FRAMEINTERVALSTEP     0x000186A0            // 10ms Interval  ;;  (FRAMEINTERVALSTEP*100)ns

#define NO_PROC_UNIT_CONTROLS_SUPPORTED     0x0A

#define GET_MIN_VAL_INDEX                   0x00
#define GET_MAX_VAL_INDEX                   0x01
#define GET_DEF_VAL_INDEX                   0x02
#define GET_RES_VAL_INDEX                   0x03
#define GET_INFO_VAL_INDEX                  0x04
#define GET_CUR_VAL_INDEX                   0x05

#define NO_OF_TERMINALS                     0x03        /**< This macro defines number of terminal usded in UVC function. */

#define PU_BMCONTROLS_INDEX                 0x00
#define CAM_BMCONTROLS_INDEX                0x01
#define EU_BMCONTROLS_INDEX                 0x00//TODO check me

#define VC_ERR_CODE_INDEX                   0x00

#define RECEPIENT_IS_PROCESSING_UNIT    0x03            /**< This macro defines request is for Processing Unit. */
#define RECEPIENT_IS_EXTENSION_UNIT     0x04            /**< This macro defines request is for Extension Unit. */
#define RECEPIENT_IS_OUTPUT_TERMINAL    0x02            /**< This macro defines request is for Output Terminal. */
#define RECEPIENT_IS_CAMERA_TERMINAL    0x01            /**< This macro defines request is for Camera Termina. */

/************************** TypeDef Definitions *****************************/
/*
 * USB Video Class structure Definitions
 */

/**
 * @brief UVC Probe Commit Control data structure.
 */
typedef struct {

    union BmHint {
        uint16_t val;
        struct Bits_bmHint {
            uint8_t dwFrameInterval :1;
            uint8_t wKeyFrameRate :1;
            uint8_t wPFrameRate :1;
            uint8_t wCompQuality :1;
            uint8_t wCompWindowSize :1;

        } bits_bmHint;

    } bmHint;

    uint8_t bFormatIndex;
    uint8_t bFrameIndex;
    uint32_t dwFrameInterval;
    uint16_t wKeyFrameRate;
    uint16_t wPFrameRate;
    uint16_t wCompQuality;
    uint16_t wCompWindowSize;
    uint16_t wDelay;
    uint32_t dwMaxVideoFrameSize;
    uint32_t dwMaxPayloadTransferSize;

#ifdef UVC1_5
    //UVC1.1
    uint32_t dwClockFrequency;

       union BmFramingInfo {
           uint8_t val;
           struct bits_bmFramingInfo {
               uint8_t D0 :1;
               uint8_t D1 :1;

           } D1;

       } bmFramingInfo;

       uint8_t bPreferedVersion;
       uint8_t bMinVersion;
       uint8_t bMaxVersion;

       //UVC1.5
       uint8_t bUsage;
       uint8_t bBitDepthLuma;
       uint8_t bmSettings;
       uint8_t bMaxNumberOfRefFramesPlus1;
       uint16_t bmRateControlModes;
       uint16_t bmLayoutPerStream[NO_OF_SIMULCAST_STREAM_SUPPORTED];
#endif

} VIDEO_PROBE_AND_COMMIT_CONTROL;

/**
 * @brief UVC Still Image Probe Commit Control data structure.
 */
typedef struct {

    uint8_t bFormatIndex;
    uint8_t bFrameIndex;
    uint8_t bCompressionIndex;
    uint32_t dwMaxVideoFrameSize;
    uint32_t dwMaxPayloadTransferSize;

} VIDEO_STILL_IMG_PROBECOMMIT_CONTROL;

/**
 * @brief This typedef defines format of Payload Header.
 */
typedef struct {
    uint8_t bHeaderLength;
    union BmHeaderInfo {
        uint8_t byte;
        struct BitsbmHeaderInfo {
            uint8_t FrameId :1;
            uint8_t EOFrame :1;
            uint8_t PresentationTime :1;
            uint8_t SourceClockRef :1;
            uint8_t Reserved :1;
            uint8_t StillImage :1;
            uint8_t Error :1;
            uint8_t EndOfHeader :1;

        } bits_bmHeaderInfo;

    } bmHeaderInfo;

} FORMAT_OF_PAYLOAD_HEADER;

/**
 *  @brief USB Video Control Interface Descriptor Structure.
 */
typedef struct {
    uint8_t bLength;
    uint8_t bDescriptorType;
    uint8_t bDescriptorSubType;
    uint16_t bcdUVC;
    uint16_t wTotalLength;
    uint32_t dwClockFrequency;
    uint8_t bInCollection;
    uint8_t baInterfaceNr[NO_OF_VIDEO_STREAMING_INTERFACES];
} __attribute__ ((packed))  (USB_UVC_VCID);

/**
 *  @brief USB UVC Camera Terminal Descriptor Structure.
 */
typedef struct {
    uint8_t bLength;
    uint8_t bDescriptorType;
    uint8_t bDescriptorSubtype;
    uint8_t bTerminalID;
    uint16_t wTerminalType;
    uint8_t bAssocTerminal;
    uint8_t iTerminal;
    uint16_t wObjectiveFocalLengthMin;
    uint16_t wObjectiveFocalLengthMax;
    uint16_t wOcularFocalLength;
    uint8_t bControlSize;
    uint8_t bmControls[NO_OF_CAMERA_CONTROLS_SUPPORTED];//If UVC1.5 then there is change in NO_OF_CAMERA_CONTROLS_SUPPORTED
} __attribute__ ((packed))  (USB_UVC_CTD);

/**
 *  @brief USB UVC Output Terminal Descriptor Structure.
 */
typedef struct {
    uint8_t bLength;
    uint8_t bDescriptorType;
    uint8_t bDescriptorSubtype;
    uint8_t bTerminalID;
    uint16_t wTerminalType;
    uint8_t bAssocTerminal;
    uint8_t bSourceID;
    uint8_t iTerminal;
} __attribute__ ((packed))  (USB_UVC_OTD);

/**
 *  @brief USB UVC Processing Unit Descriptor Structure.
 */
typedef struct {
    uint8_t bLength;
    uint8_t bDescriptorType;
    uint8_t bDescriptorSubtype;
    uint8_t bUnitID;
    uint8_t bSourceID;
    uint16_t wMaxMultiplier;
    uint8_t bControlSize;
    uint8_t bmControls[NO_OF_PROCESSING_UNIT_0_CONTROLS_SUPPORTED];//If there is UVC1.5 support then change in NO_OF_PROCESSING_UNIT_0_CONTROLS_SUPPORTED
    uint8_t iProcessing;
#ifdef UVC1_5
    uint8_t bmVideoStandards;// This field isn't supported in UVC1.0 specification
#endif
} __attribute__ ((packed))  (USB_UVC_PUD);

/**
 *  @brief USB UVC Extension Unit Descriptor Structure.
 */
typedef struct {
    uint8_t bLength;
    uint8_t bDescriptorType;
    uint8_t bDescriptorSubtype;
    uint8_t bUnitID;
    uint8_t guidExtensionCode[16];
    uint8_t bNumControls;
    uint8_t bNrInPins;
    uint8_t bSourceID[NO_OF_EXTENSION_UNIT_INPUT_PINS_SUPPORTED];
    uint8_t bControlSize;
    uint8_t bmControls[EXTENSION_UNIT_CONTROLS_SUPPORTED_SZ];//If there is UVC1.5 support then change in NO_OF_PROCESSING_UNIT_0_CONTROLS_SUPPORTED
    uint8_t iExtension;
} __attribute__ ((packed))  (USB_UVC_XUD);

/**
 *  @brief USB UVC Class Specific Interrupt Endpoint
 *         Descriptor Structure.
 */
typedef struct {
    uint8_t bLength;
    uint8_t bDescriptorType;
    uint8_t bDescriptorSubtype;
    uint16_t wMaxTransferSize;
} __attribute__ ((packed))  (USB_UVC_CS_INT_EP);

/**
 *  @brief USB UVC Video Streaming Interface
 *         Input Header Descriptor Structure.
 */
typedef struct {
    uint8_t bLength;
    uint8_t bDescriptorType;
    uint8_t bDescriptorSubtype;
    uint8_t bNumFormats;
    uint16_t wTotalLength;
    uint8_t bEndpointAddress;
    uint8_t bmInfo;
    uint8_t bTerminalLink;
    uint8_t bStillCaptureMethod;
    uint8_t bTriggerSupport;
    uint8_t bTriggerUsage;
    uint8_t bControlSize;
    uint8_t bmaControls[NO_OF_FORMATS_SUPPORTED_BY_VIDEO_STREAM_INTERFACE];
} __attribute__ ((packed))  (USB_UVC_VSIHD);

/**
 *  @brief USB UVC Uncompressed Video Format Descriptor Structure.
 */
typedef struct {
    uint8_t bLength;
    uint8_t bDescriptorType;
    uint8_t bDescriptorSubtype;
    uint8_t bFormatIndex;
    uint8_t bNumFrameDescriptors;
    uint8_t guidFormat[16];
    uint8_t bBitsPerPixel;
    uint8_t bDefaultFrameIndex;
    uint8_t bAspectRatioX;
    uint8_t bAspectRatioY;
    uint8_t bmInterlaceFlags;
    uint8_t bCopyProtect;
} __attribute__ ((packed))  (USB_UVC_UVFD);

/**
 *  @brief USB UVC Uncompressed Video Continues Frame Descriptor Structure.
 */
typedef struct {
    uint8_t bLength;
    uint8_t bDescriptorType;
    uint8_t bDescriptorSubtype;
    uint8_t bFrameIndex;
    uint8_t bmCapabilities;
    uint16_t wWidth;
    uint16_t wHeight;
    uint32_t dwMinBitRate;
    uint32_t dwMaxBitRate;
    uint32_t dwMaxVideoFrameBufferSize;
    uint32_t dwDefaultFrameInterval;
    uint8_t bFrameIntervalType;
    uint32_t dwMinFrameInterval;
    uint32_t dwMaxFrameInterval;
    uint32_t dwFrameIntervalStep;
} __attribute__ ((packed))  (USB_UVC_UVCFD);

/**
 *  @brief USB UVC MJPEG Video Format Descriptor Structure.
 */
typedef struct {
    uint8_t bLength;
    uint8_t bDescriptorType;
    uint8_t bDescriptorSubtype;
    uint8_t bFormatIndex;
    uint8_t bNumFrameDescriptors;
    uint8_t bmFlags;
    uint8_t bDefaultFrameIndex;
    uint8_t bAspectRatioX;
    uint8_t bAspectRatioY;
    uint8_t bmInterlaceFlags;
    uint8_t bCopyProtect;
} __attribute__ ((packed))  (USB_UVC_MVFD);

/**
 *  @brief USB UVC MJPEG Video Continuous Frame Descriptor Structure.
 */
typedef struct {
    uint8_t bLength;
    uint8_t bDescriptorType;
    uint8_t bDescriptorSubtype;
    uint8_t bFrameIndex;
    uint8_t bmCapabilities;
    uint16_t wWidth;
    uint16_t wHeight;
    uint32_t dwMinBitRate;
    uint32_t dwMaxBitRate;
    uint32_t dwMaxVideoFrameBufferSize;
    uint32_t dwDefaultFrameInterval;
    uint8_t bFrameIntervalType;
    uint32_t dwMinFrameInterval;
    uint32_t dwMaxFrameInterval;
    uint32_t dwFrameIntervalStep;
} __attribute__ ((packed))  (USB_UVC_MVCFD);

/**
 *  @brief USB UVC Still Image Frame Descriptor Structure.
 */
typedef struct {
    uint8_t bLength;
    uint8_t bDescriptorType;
    uint8_t bDescriptorSubtype;
    uint8_t bEndpointAddress;
    uint8_t bNumImageSizePatterns;

    uint16_t Img2D_H_X_W[NO_OF_FRAMES_IN_STILL_IMAGE][2]; // COL 0- WIDTH , COL 1- HEIGHT

    uint8_t bNumCompressionPattern;
    //uint8_t         bCompression[NO_OF_FRAMES_IN_STILL_IMAGE-1];
} __attribute__ ((packed))  (USB_UVC_SIFD);

/**
 *  @brief USB UVC Color Matching Descriptor Structure.
 */
typedef struct {
    uint8_t bLength;
    uint8_t bDescriptorType;
    uint8_t bDescriptorSubtype;
    uint8_t bColorPrimaries;
    uint8_t bTransferCharacteristics;
    uint8_t bMatrixCoefficients;
} __attribute__ ((packed))  (USB_UVC_CMD);

#define VCID_TOTAL_LEN                       sizeof(USB_UVC_VCID) + sizeof(USB_UVC_CTD) + sizeof(USB_UVC_OTD) + sizeof(USB_UVC_XUD)

#ifdef UVC_YUY2
#define VSI_IHD_TOTAL_LEN                     sizeof(USB_UVC_VSIHD)+\
                                              sizeof(USB_UVC_UVFD)+\
                                              sizeof(USB_UVC_UVCFD)+\
                                              sizeof(USB_UVC_CMD)
#else
#define VSI_IHD_TOTAL_LEN                     sizeof(USB_UVC_VSIHD)+\
                                              sizeof(USB_UVC_MVFD)+\
                                              sizeof(USB_UVC_MVCFD)+\
                                              sizeof(USB_UVC_CMD)
#endif

/**
 *  @brief Lattice USB20 UVC YUY2 Bulk Transfer Configuration
 *         Descriptor Structure.
 */
typedef struct {
    USB_STD_CFG_DESC cfg;
    USB_STD_IAD iad;
    USB_STD_IF_DESC vc_intf_0;
    USB_UVC_VCID vcid;
    USB_UVC_CTD vc_ctd;
    USB_UVC_OTD vc_otd;
//    USB_UVC_PUD pud;
    USB_UVC_XUD vc_xud;
#ifdef STILL_IMG_CAP
    USB_STD_EP_DESC vc_int_ep_in;
    USB_UVC_CS_INT_EP vc_cs_int_ep_in;
#endif
    USB_STD_IF_DESC vs_intf_1;
    USB_UVC_VSIHD vsihd;
#ifdef UVC_YUY2
    USB_UVC_UVFD vs_uvfd;
    USB_UVC_UVCFD vs_uvcfd;
#else
    USB_UVC_MVFD vs_mvfd;
    USB_UVC_MVCFD vs_mvcfd;
#endif
#ifdef STILL_IMG_CAP
    USB_UVC_SIFD vs_sifd;
#endif
    USB_UVC_CMD vs_cmd;
    USB_STD_EP_DESC vs_bulk_ep_in;
} __attribute__ ((packed)) (LSC_YUY2_BULK_CFG_DESC_HS);


/**
 *  @brief Lattice USB20 UVC YUY2 Bulk Transfer Configuration
 *         Descriptor Structure.
 */
typedef struct {
    USB_STD_CFG_DESC cfg;
    USB_STD_IAD iad;
    USB_STD_IF_DESC vc_intf_0;
    USB_UVC_VCID vcid;
    USB_UVC_CTD vc_ctd;
    USB_UVC_OTD vc_otd;
//    USB_UVC_PUD pud;
    USB_UVC_XUD vc_xud;
#ifdef STILL_IMG_CAP
    USB_STD_EP_DESC vc_int_ep_in;
    USB_STD_EP_SS_COMP_DESC vc_int_ep_in_comp;
    USB_UVC_CS_INT_EP vc_cs_int_ep_in;
#endif
    USB_STD_IF_DESC vs_intf_1;
    USB_UVC_VSIHD vsihd;
#ifdef UVC_YUY2
    USB_UVC_UVFD vs_uvfd;
    USB_UVC_UVCFD vs_uvcfd;
#else
    USB_UVC_MVFD vs_mvfd;
    USB_UVC_MVCFD vs_mvcfd;
#endif
#ifdef STILL_IMG_CAP
    USB_UVC_SIFD vs_sifd;
#endif
    USB_UVC_CMD vs_cmd;
    USB_STD_EP_DESC vs_bulk_ep_in;
    USB_STD_EP_SS_COMP_DESC vs_bulk_ep_in_comp;
} __attribute__ ((packed))(LSC_YUY2_BULK_CFG_DESC_SS);

///**
// *  @brief USB20 High Speed Configuration Descriptor Data.
// */
//LSC_YUY2_BULK_CFG_DESC_HS __attribute__ ((aligned(4))) yuy2_bulk_cfg_desc_hs = {{
////Standard Configuration Descriptor
//        sizeof(USB_STD_CFG_DESC),
//        USB_TYPE_CONFIG_DESC,
//        sizeof(LSC_YUY2_BULK_CFG_DESC_HS),
//        0x02,/* bNumInterfaces */
//        0x01,/* bConfigurationValue */
//        0x00,/* iConfiguration */
//        0xC0,/* bmAttributes */
//        0x32/* bMaxPower */
//},
//
//{
////Standard Interface Association DescriptorDescriptor
//        sizeof(USB_STD_IAD),
//        USB_TYPE_INTERFACE_ASSOCIATION,
//        0x00,
//        0x02,
//        CC_VIDEO,
//        SC_VIDEO_INTERFACE_COLLECTION,
//        PC_PROTOCOL_UNDEFINED,
//        0x02
//},
//
//{
////Standard Interface Descriptor (Video Control Interface)
//        sizeof(USB_STD_IF_DESC),
//        USB_TYPE_INTERFACE_DESC,
//        0x00,
//        0x00,
//        NO_OF_EP_INTERFACE_DESC_BULK,
//        CC_VIDEO ,
//        SC_VIDEOCONTROL,
//        PC_PROTOCOL_VAL,
//        0x02
//},
//
//{
////Class Specific Video Control Interface Descriptor
//        sizeof(USB_UVC_VCID),
//        CS_INTERFACE,
//        VC_HEADER,
//        BCD_UVC,
//        VCID_TOTAL_LEN,
//        DEV_CLK_FREQ,
//        0x01,
//        {0x01}
//},
//
//{
////Input Terminal Descriptor (Camera)
//        sizeof(USB_UVC_CTD),
//        CS_INTERFACE,
//        VC_INPUT_TERMINAL,
//        0x01,
//        ITT_CAMERA,
//        0x02,
//        0x00,
//        0x00,
//        0x00,
//        0x00,
//        NO_OF_CAMERA_CONTROLS_SUPPORTED,
//        CTD_BM_CTRLS
//},
//
//{
////Output Terminal Descriptor
//        sizeof(USB_UVC_OTD),
//        CS_INTERFACE,
//        VC_OUTPUT_TERMINAL,
//        0x02,
//        TT_STREAMING,
//        0x01,
//        0x01,
//        0x00
//},
//
////{
//////Processing Unit Descriptor
////        sizeof(USB_UVC_PUD),
////        CS_INTERFACE,
////        VC_PROCESSING_UNIT,
////        PU_0_D_ID,
////        0x01,
////        0x00,
////        NO_OF_PROCESSING_UNIT_0_CONTROLS_SUPPORTED,
////        PU_D_BM_CTRLS,
////        0x00,
////        0x00
////},
//
//{
////Extension Unit Descriptor
//        sizeof(USB_UVC_XUD),
//        CS_INTERFACE,
//        VC_EXTENSION_UNIT,
//        EU_D_ID,
//        0xFF, 0xFF, 0xFF, 0xFF,
//        0xFF, 0xFF, 0xFF, 0xFF,
//        0xFF, 0xFF, 0xFF, 0xFF,
//        0xFF, 0xFF, 0xFF, 0xFF,
//        NO_OF_EXTENSION_UNIT_CONTROLS_SUPPORTED,
//        NO_OF_EXTENSION_UNIT_INPUT_PINS_SUPPORTED,
//        EU_D_SRC_ID,
//        EXTENSION_UNIT_CONTROLS_SUPPORTED_SZ,
//        EU_D_BM_CTRLS,
//        0x00
//},
//
//#ifdef STILL_IMG_CAP
//{
////Interrupt In Endpoint Descriptor
//        sizeof(USB_STD_EP_DESC), /* bLength */
//        USB_TYPE_ENDPOINT_CFG_DESC, /* bDescriptorType */
//        0x82, /* bEndpointAddress */
//        USB_EP_INTERRUPT, /* bmAttribute  */
//        0x0008, /* wMaxPacketSize */
//        0x0A, /* bInterval */
//},
//
//{
////Class Specific Interrupt In Endpoint Descriptor
//        sizeof(USB_UVC_CS_INT_EP),
//        CS_ENDPOINT,
//        EP_INTERRUPT,
//        0x0020
//},
//#endif
//
//{
////Standard Interface Descriptor (Video Streaming Interface)
//        sizeof(USB_STD_IF_DESC),
//        USB_TYPE_INTERFACE_DESC,
//        0x01,
//        0x00,
//        0x01,
//        CC_VIDEO,
//        SC_VIDEOSTREAMING,
//        PC_PROTOCOL_VAL,
//        0x00
//},
//
//{
////Class Specific VS Input Header Descriptor
//        sizeof(USB_UVC_VSIHD),
//        CS_INTERFACE,
//        VS_INPUT_HEADER,
//        NO_OF_FORMATS_SUPPORTED_BY_VIDEO_STREAM_INTERFACE,
//        VSI_IHD_TOTAL_LEN,
//        0x81,
//        0x00,
//        0x02,
//        STILL_IMG_CAP_METHOD,
//        TRIGGER_SUPPORT,
//        0x00,
//        0x01,
//        {0x00}
//},
//
//#ifdef UVC_YUY2
//{
////Uncompressed Video Format Descriptor
//        sizeof(USB_UVC_UVFD),
//        CS_INTERFACE,
//        VS_FORMAT_UNCOMPRESSED,
//        0x01,
//        0x01,
//        YUY2_GUID,
//        BITSPERPIXEL,
//        0x01,
//        0x00,
//        0x00,
//        0x00
//},
//
//{
////Uncompressed Video Continues Frame Descriptor
//        sizeof(USB_UVC_UVCFD),
//        CS_INTERFACE,
//        VS_FRAME_UNCOMPRESSED,
//        UVCFD_FRAME_INDEX,
//        UVCFD_CAPABILITIES,
//        WIDTH,
//        HEIGHT,
//        MAXBITRATE,
//        MINBITRATE,
//        (((WIDTH*HEIGHT*BITSPERPIXEL)/8)+2),
//        DEFAULTFRAMEINTERVAL,
//        UVCFD_FRAMEINTERVALTYPE,
//        MINIMUMFRAMEINTERVAL,
//        (MINIMUMFRAMEINTERVAL + FRAMEINTERVALSTEP),
//        FRAMEINTERVALSTEP
//},
//#else
//{
////MJPEG Video Format Descriptor
//        sizeof(USB_UVC_MVFD),
//        CS_INTERFACE,
//        VS_FORMAT_MJPEG,
//        0x01,
//        0x01,
//        0x01,
//        0x01,
//        0x00,
//        0x00,
//        0x00,
//        0x00
//},
//
//{
////MJPEG Video Continues Frame Descriptor
//        sizeof(USB_UVC_MVCFD),
//        CS_INTERFACE,
//        VS_FRAME_MJPEG,
//        0x01,
//        0x00,
//        0x0780,/*height*/
//        0x0438,/*width*/
//        0x001A99A0,
//        0x001B56C8,
//        0x001C2002,
//        0x00041FBE,
//        0x00,
//        0x00041FBE,
//        0x00043D11,
//        0x00000001
//},
//#endif
//
//#ifdef STILL_IMG_CAP
//{
////Class-specific Still Image Frame Descriptor
//        sizeof(USB_UVC_SIFD),
//        CS_INTERFACE,
//        VS_STILL_IMAGE_FRAME,
//        0x00,
//        NO_OF_FRAMES_IN_STILL_IMAGE,
//        {{0x0140,0xF0}},
//        (NO_OF_FRAMES_IN_STILL_IMAGE-1)
//},
//#endif
//{
////Class-specific Color Matching Descriptor
//        sizeof(USB_UVC_CMD),\
//        CS_INTERFACE,\
//        VS_COLORFORMAT,\
//        0x00,\
//        0x00,\
//        0x00\
//},
//
//{
////Standard VS Bulk In Endpoint Descriptor
//        sizeof(USB_STD_EP_DESC), /* bLength */
//        USB_TYPE_ENDPOINT_CFG_DESC, /* bDescriptorType */
//        0x81, /* bEndpointAddress */
//        USB_EP_BULK, /* bmAttribute  */
//        0x0200, /* wMaxPacketSize */
//        0x01, /* bInterval */
//}};

void configure_uvc_device();

#ifdef __cplusplus
}
#endif

/************************** Function Prototypes ******************************/
/*
 * Functions in lsc_uvc.c
 */

#endif /* UVC_LSC_UVC_H_ */

/** @} */
